{"version":3,"sources":["webpack://jso/webpack/bootstrap","webpack://jso/./src/Loaders/BasicLoader.js","webpack://jso/./src/utils.js","webpack://jso/./src/errors/Error.js","webpack://jso/./src/EventEmitter.js","webpack://jso/./src/Config.js","webpack://jso/./src/errors/OAuthResponseError.js","webpack://jso/./src/errors/ExpiredTokenError.js","webpack://jso/./src/HTTP/Fetcher.js","webpack://jso/./src/Loaders/Popup.js","webpack://jso/./src/Loaders/IFramePassive.js","webpack://jso/./src/store.js","webpack://jso/./src/JSO.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","BasicLoader","url","_classCallCheck","this","console","log","utils","Math","round","Date","getTime","replace","random","toString","indexOf","parseQueryString","substring","qs","e","a","decodeURIComponent","q","urlParams","exec","scopes","uniqueList","join","items","uniqueItems","resultItems","length","key","push","msg","debug","args","Array","slice","arguments","unshift","apply","params","k","res","encodeURIComponent","firstSeparator","Error","props","EventEmitter","type","callback","_callbacks","Config","config","assign","pointer","splittedKeys","split","defaultValue","isRequired","undefined","_Error2","OAuthResponseError","error","error_description","ExpiredTokenError","_ExpiredTokenError","Fetcher","jso","opts","fetch","then","response","status","_ExpiredTokenError2","default","reccur","_this","getTokenOpts","fetchOpts","mode","getToken","catch","err","token","headers","Authorization","access_token","_fetch","wipeTokens","_BasicLoader2","Popup","_this2","Promise","resolve","reject","window","popupCompleted","newwindow","location","href","open","focus","IFramePassive","redirect_uri","_possibleConstructorReturn","__proto__","getPrototypeOf","timeout","isCompleted","id","_utils2","uuid","eventMethod","addEventListener","data","hash","origin","_completed","_failed","iframe","document","createElement","setAttribute","errorCallback","getElementsByTagName","appendChild","setTimeout","element","getElementById","parentNode","removeChild","_cleanup","_utils","Store","state","obj","localStorage","setItem","JSON","stringify","parse","getItem","removeItem","scope","tokens","j","usethis","result","now","epoch","expires","hasScope","provider","getTokens","filterTokens","saveTokens","default_config","lifetime","JSO","Tangere","identity","configure","providerID","getProviderID","Loader","_IFramePassive2","store","_store2","callbacks","getValue","_Config2","newstore","loader","client_id","atoken","useStore","getState","processReceivedToken","received","expires_in","parseInt","has","saveToken","restoreHash","emit","Headers","append","btoa","tokenRequest","grant_type","code","method","body","encodeQS","httpResponse","json","tokenResponse","_OAuthResponseError2","_typeof","getResponseFromURL","processTokenResponse","processAuthorizationCodeResponse","processErrorResponse","request","require","_this3","response_type","prompt","scopesRequire","_getRequiredScopes","allowredir","_authorize","authurl","_this4","openid","authorization","login_hint","_getRequestScopes","includes","scopeList","nonce","encodeURL","saveState","gotoAuthorizeURL","execute"],"mappings":"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","file":"jso.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","export default class BasicLoader {\r\n\tconstructor(url) {\r\n\t\tconsole.log(\"Initializing a loader with url \" + url)\r\n\t\tthis.url = url\r\n\t}\r\n\texecute() {\r\n\r\n\t}\r\n}\r\n","\r\nlet utils = {}\r\n\r\n/*\r\n * Returns epoch, seconds since 1970.\r\n * Used for calculation of expire times.\r\n */\r\nutils.epoch = function () {\r\n\treturn Math.round(new Date().getTime() / 1000.0)\r\n}\r\n\r\nutils.debug = false\r\n\r\n/*\r\n * Returns a random string used for state\r\n */\r\nutils.uuid = function () {\r\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n\t\tvar r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8)\r\n\t\treturn v.toString(16)\r\n\t})\r\n}\r\n\r\n/*\r\n * Takes a full url as input and expect it to have an encoded response\r\n * object as eigther a query string or an encoded fragment.\r\n * Returns the decoded object, or throws an error if no query string or fragment.\r\n */\r\nutils.getResponseFromURL = function (url) {\r\n\tif (url.indexOf('#') !== -1) {\r\n\t\treturn utils.parseQueryString(url.substring(url.indexOf('#') + 1))\r\n\t} else if (url.indexOf('?') !== -1) {\r\n\t\treturn utils.parseQueryString(url.substring(url.indexOf('?') + 1))\r\n\t}\r\n\treturn {}\r\n}\r\n\r\nutils.parseQueryString = function (qs) {\r\n\tvar e,\r\n\t\ta = /\\+/g,  // Regex for replacing addition symbol with a space\r\n\t\tr = /([^&;=]+)=?([^&;]*)/g,\r\n\t\td = function (s) { return decodeURIComponent(s.replace(a, \" \")) },\r\n\t\tq = qs,\r\n\t\turlParams = {}\r\n\r\n\t/* jshint ignore:start */\r\n\twhile (e = r.exec(q)) {\r\n\t\turlParams[d(e[1])] = d(e[2])\r\n\t};\r\n\t/* jshint ignore:end */\r\n\r\n\treturn urlParams\r\n}\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Utility: scopeList(scopes )\r\n * Takes a list of scopes that might be overlapping, and removed duplicates,\r\n * then concatenates the list by spaces and returns a string.\r\n *\r\n * @param  {[type]} scopes [description]\r\n * @return {[type]}        [description]\r\n */\r\nutils.scopeList = function (scopes) {\r\n\treturn utils.uniqueList(scopes).join(' ')\r\n}\r\n\r\n\r\nutils.uniqueList = function (items) {\r\n\tvar uniqueItems = {}\r\n\tvar resultItems = []\r\n\tfor (var i = 0; i < items.length; i++) {\r\n\t\tuniqueItems[items[i]] = 1\r\n\t}\r\n\tfor (var key in uniqueItems) {\r\n\t\tif (uniqueItems.hasOwnProperty(key)) {\r\n\t\t\tresultItems.push(key)\r\n\t\t}\r\n\t}\r\n\treturn resultItems\r\n}\r\n\r\n\r\n\r\n/**\r\n * A log wrapper, that only logs if logging is turned on in the config\r\n * @param  {string} msg Log message\r\n */\r\nutils.log = function (msg) {\r\n\tif (!console) return\r\n\tif (!console.log) return\r\n\tif (!utils.debug) return\r\n\r\n\tlet args = Array.prototype.slice.call(arguments)\r\n\targs.unshift('[JSO]')\r\n\tconsole.log.apply(console, args)\r\n}\r\n\r\nutils.encodeQS = function (params) {\r\n\tlet res = ''\r\n\tvar k, i = 0\r\n\tfor (k in params) {\r\n\t\tres += (i++ === 0 ? '' : '&') + encodeURIComponent(k) + '=' + encodeURIComponent(params[k])\r\n\t}\r\n\treturn res\r\n}\r\n\r\n/*\r\n * Takes an URL as input and a params object.\r\n * Each property in the params is added to the url as query string parameters\r\n */\r\nutils.encodeURL = function (url, params) {\r\n\tvar res = url;\r\n\tvar k, i = 0;\r\n\tvar firstSeparator = (url.indexOf(\"?\") === -1) ? '?' : '&';\r\n\r\n\tfor (k in params) {\r\n\t\tres += (i++ === 0 ? firstSeparator : '&') + encodeURIComponent(k) + '=' + encodeURIComponent(params[k]);\r\n\t}\r\ndebugger;\r\n\treturn res\r\n}\r\n\r\n\r\nexport default utils\r\n","\r\nexport default class Error {\r\n\tconstructor(props) {\r\n\t\tfor(var key in props) {\r\n\t\t\tthis[key] = props[key];\r\n\t\t}\r\n\t}\r\n\r\n\tset(key, value) {\r\n\t\tthis[key] = value;\r\n\t\treturn this;\r\n\t}\r\n}","export default class EventEmitter {\r\n\r\n  on(type, callback) {\r\n    if (!this._callbacks) {\r\n      this._callbacks = {}\r\n    }\r\n    if (!this._callbacks[type]) {\r\n      this._callbacks[type] = []\r\n    }\r\n\r\n    this._callbacks[type].push(callback)\r\n  }\r\n\r\n  emit(type) {\r\n    if (!this._callbacks) {\r\n      this._callbacks = {}\r\n    }\r\n    if (!this._callbacks[type]) {\r\n      this._callbacks[type] = []\r\n    }\r\n\r\n    var args = Array.prototype.slice.call(arguments, 1)\r\n    for(var i = 0; i < this._callbacks[type].length; i++) {\r\n      this._callbacks[type][i].apply(this, args)\r\n    }\r\n  }\r\n}\r\n","export default class Config {\r\n\r\n\tconstructor() {\r\n    this.config = {}\r\n\t\tfor(var i = 0; i < arguments.length; i++) {\r\n      Object.assign(this.config, arguments[i])\r\n\t\t}\r\n\t}\r\n\r\n\thas(key) {\r\n\t\tvar pointer = this.config\r\n\t\tvar splittedKeys = key.split('.')\r\n\t\tvar i = 0\r\n\t\tfor(i = 0; i < splittedKeys.length; i++) {\r\n\t\t\tif (pointer.hasOwnProperty(splittedKeys[i])) {\r\n\t\t\t\tpointer = pointer[splittedKeys[i]]\r\n\t\t\t} else {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true\r\n\t}\r\n\r\n\tgetValue(key, defaultValue, isRequired) {\r\n\t\tvar isRequired = isRequired || false\r\n\t\tvar pointer = this.config\r\n\t\tvar splittedKeys = key.split('.')\r\n\t\tvar i = 0\r\n\t\tfor(i = 0; i < splittedKeys.length; i++) {\r\n\r\n\t\t\tif (pointer.hasOwnProperty(splittedKeys[i])) {\r\n\t\t\t\t// console.log(\"POINTING TO \" + splittedKeys[i]);\r\n\t\t\t\tpointer = pointer[splittedKeys[i]]\r\n\t\t\t} else {\r\n\t\t\t\tpointer = undefined\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (typeof pointer === 'undefined') {\r\n\t\t\tif (isRequired) {\r\n\t\t\t\tthrow new Error(\"Configuration option [\" + splittedKeys[i] + \"] required but not provided.\")\r\n\t\t\t}\r\n\t\t\treturn defaultValue\r\n\t\t}\r\n\t\treturn pointer\r\n\t}\r\n}\r\n","import Error from './Error'\r\n\r\nexport default class OAuthResponseError extends Error {\r\n\r\n  toString() {\r\n    let header = this.error || 'unknown'\r\n    let descr = this.error_description || 'unknown'\r\n    return 'OAuthResponseError: [' + header + ']: ' + descr\r\n  }\r\n}\r\n","import Error from './Error';\r\n\r\nexport default class ExpiredTokenError extends Error {\r\n\r\n}","\r\nimport ExpiredTokenError from '../errors/ExpiredTokenError'\r\n\r\nexport default class Fetcher {\r\n\tconstructor(jso) {\r\n    this.jso = jso\r\n\t}\r\n\r\n  _fetch(url, opts) {\r\n    return fetch(url, opts)\r\n      .then((response) => {\r\n        if (response.status === 401) {\r\n          throw new ExpiredTokenError()\r\n        }\r\n        return response\r\n      })\r\n  }\r\n\r\n\tfetch(url, opts, reccur) {\r\n    reccur = reccur ? reccur : 0\r\n    if (reccur > 2) {\r\n      throw new Error(\"Reccursion error. Expired tokens deleted and tried again multiple times.\")\r\n    }\r\n    let getTokenOpts = {}\r\n    let fetchOpts = {\r\n      'mode': 'cors'\r\n    }\r\n    if (opts) {\r\n      fetchOpts = opts\r\n      Object.assign(fetchOpts, opts)\r\n    }\r\n    if (opts && opts.jso) {\r\n      Object.assign(getTokenOpts, opts.jso)\r\n    }\r\n\r\n    return this.jso.getToken(getTokenOpts)\r\n      .catch((err) => {\r\n        console.error(\"Error fetching token to use \", err)\r\n      })\r\n      .then((token) => {\r\n      \t// console.log(\"I got the token: \", token.access_token)\r\n\r\n        if (!fetchOpts.headers) {\r\n          fetchOpts.headers = {}\r\n        }\r\n        fetchOpts.headers.Authorization = 'Bearer ' + token.access_token\r\n        return this._fetch(url, fetchOpts)\r\n          .catch((err) => {\r\n            if (err instanceof ExpiredTokenError) {\r\n              console.error(\"Token was expired. Deleting all tokens for this provider and get a new one\", err)\r\n              this.jso.wipeTokens()\r\n              return this.fetch(url, opts, reccur+1)\r\n            }\r\n          })\r\n\r\n      })\r\n\t}\r\n\r\n\r\n\r\n}\r\n","import BasicLoader from './BasicLoader'\r\n\r\nexport default class Popup extends BasicLoader {\r\n\r\n  execute() {\r\n\r\n\t\t/*\r\n\t\t* In the popup's scripts, running on <http://example.org>:\r\n\t\t*/\r\n\t\treturn new Promise((resolve, reject) => {\r\n\r\n\t\t\t// window.addEventListener(\"jso_message\", function(event) {\r\n\t\t\t// \tconsole.log(\"Sent a message to event.origin \" + event.origin + \" and got the following in response:\")\r\n\t\t\t// \tconsole.log(\"<em>\", event.data, \"</em>\")\r\n\t    // \tvar url = newwindow.location.href\r\n\t    // \t// console.error(\"Popup location is \", url, newwindow.location)\r\n      //   resolve(url)\r\n\t\t\t// })\r\n\r\n  \t\twindow.popupCompleted = function() {\r\n\t    \tvar url = newwindow.location.href\r\n        resolve(url)\r\n\t\t\t}\r\n\r\n\t\t\tvar newwindow = window.open(this.url, 'jso-popup-auth', 'height=600,width=800')\r\n      if (newwindow === null) {\r\n        throw new Error(\"Error loading popup window\")\r\n      }\r\n\t\t\tif (window.focus) {\r\n\t\t\t\tnewwindow.focus()\r\n\t\t\t}\r\n\r\n\t\t})\r\n\t}\r\n}\r\n","import BasicLoader from './BasicLoader'\r\nimport utils from '../utils'\r\n\r\nexport default class IFramePassive extends BasicLoader {\r\n\r\n  constructor(url, redirect_uri) {\r\n    super(url);   \r\n    this.timeout = 10000;\r\n    this.callback = null;\r\n    this.isCompleted = false;    \r\n    this.redirect_uri = redirect_uri || \"missing\";\r\n    this.id = 'jso_passive_iframe_' + utils.uuid();\r\n\r\n    // Create IE + others compatible event handler\r\n    var eventMethod = window.addEventListener ? \"addEventListener\" : \"attachEvent\";\r\n    var eventer = window[eventMethod];\r\n\r\n    window.addEventListener('message', (e) => {\r\n\r\n      if (e.data.type !== \"callback\") return;\r\n      let object = e.data.hash;\r\n\r\n      if (this.redirect_uri.indexOf(e.origin) != 0) return;\r\n\r\n      var error = \"\";\r\n      if (object.indexOf(\"#error\") == 0) {\r\n        error = decodeURIComponent(object).replace(/\\+/g, ' ');\r\n        object = null;\r\n      }\r\n\r\n      if (object !== null) {\r\n        this._completed(object);\r\n      } else {\r\n        this._failed(new Error(error ? error : \"Failed to obtain response value from iframe\"));\r\n      }\r\n\r\n    });\r\n\r\n    this.iframe = document.createElement('iframe');\r\n    this.iframe.setAttribute('id', this.id);\r\n    this.iframe.setAttribute('src', url);\r\n\r\n    /*\r\n    this.iframe.addEventListener('load', (e) => {\r\n\r\n      let object = null;\r\n      try {\r\n        if (this.iframe.contentWindow.location.hash) {\r\n          let encodedHash = this.iframe.contentWindow.location.hash.substring(1)\r\n          object = utils.parseQueryString(encodedHash)\r\n        } else if (this.iframe.contentWindow.location.search) {\r\n          let encodedHash = this.iframe.contentWindow.location.search.substring(1)\r\n          object = utils.parseQueryString(encodedHash)\r\n        }\r\n\r\n        if (object !== null) {\r\n          this._completed(object)\r\n        } else {\r\n          this._failed(new Error(\"Failed to obtain response value from iframe\"))\r\n        }\r\n      } catch (err) {\r\n        // Most likely not able to access the content window because of same-origin policy.\r\n        //\r\n        // Ignore this error, as this is likely to happen during the SSO redirect loop, but the load\r\n        // event may be triggered multiple times, so it is not neccessary a problem that the first is not\r\n        // accessible.\r\n      }     \r\n\r\n    })\r\n    */\r\n\r\n  }\r\n\r\n  execute() {\r\n    return new Promise((resolve, reject) => {\r\n      this.callback = resolve\r\n      this.errorCallback = reject\r\n      document.getElementsByTagName('body')[0].appendChild(this.iframe)\r\n\r\n      setTimeout(() => {\r\n        this._failed(new Error(\"Loading iframe timed out\"))\r\n      }, this.timeout)\r\n    })\r\n  }\r\n\r\n\r\n  _cleanup() {\r\n    let element = document.getElementById(this.id)\r\n    element.parentNode.removeChild(element)\r\n  }\r\n\r\n  _failed(err) {\r\n    if (!this.isCompleted) {\r\n      if (this.errorCallback && typeof this.errorCallback === 'function') {\r\n        this.errorCallback(err)\r\n      }\r\n      this.isCompleted = true;\r\n      this._cleanup();\r\n    }\r\n  }\r\n\r\n  _completed(response) {\r\n    if (!this.isCompleted) {\r\n\r\n      if (this.callback && typeof this.callback === 'function') {\r\n        this.callback(response);\r\n      }\r\n\r\n      this.isCompleted = true;\r\n      this._cleanup();\r\n    }\r\n  }\r\n}\r\n","import utils from './utils'\r\n\r\nclass Store {\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/*\r\n\t\tsaveState stores an object with an Identifier.\r\n\t\tTODO: Ensure that both localstorage and JSON encoding has fallbacks for ancient browsers.\r\n\t\tIn the state object, we put the request object, plus these parameters:\r\n\t\t  * restoreHash\r\n\t\t  * providerID\r\n\t\t  * scopes\r\n\r\n\t */\r\n\tsaveState(state, obj) {\r\n\t\tlocalStorage.setItem(\"state-\" + state, JSON.stringify(obj))\r\n\t}\r\n\r\n\t/**\r\n\t * getStage()  returns the state object, but also removes it.\r\n\t * @type {Object}\r\n\t */\r\n\tgetState(state) {\r\n\t\t// log(\"getState (\" + state+ \")\");\r\n\t\tvar obj = JSON.parse(localStorage.getItem(\"state-\" + state))\r\n\t\tlocalStorage.removeItem(\"state-\" + state)\r\n\t\treturn obj\r\n\t}\r\n\r\n\r\n\t/*\r\n\t * Checks if a token, has includes a specific scope.\r\n\t * If token has no scope at all, false is returned.\r\n\t */\r\n\thasScope(token, scope) {\r\n\t\tvar i\r\n\t\tif (!token.scopes) return false\r\n\t\tfor(i = 0; i < token.scopes.length; i++) {\r\n\t\t\tif (token.scopes[i] === scope) return true\r\n\t\t}\r\n\t\treturn false\r\n\t}\r\n\r\n\t/*\r\n\t * Takes an array of tokens, and removes the ones that\r\n\t * are expired, and the ones that do not meet a scopes requirement.\r\n\t */\r\n\tfilterTokens(tokens, scopes) {\r\n\t\tvar i, j,\r\n\t\t\tresult = [],\r\n\t\t\tnow = utils.epoch(),\r\n\t\t\tusethis\r\n\r\n\t\tif (!scopes) scopes = []\r\n\r\n\t\tfor(i = 0; i < tokens.length; i++) {\r\n\t\t\tusethis = true\r\n\r\n\t\t\t// Filter out expired tokens. Tokens that is expired in 1 second from now.\r\n\t\t\tif (tokens[i].expires && tokens[i].expires < (now+1)) usethis = false\r\n\r\n\t\t\t// Filter out this token if not all scope requirements are met\r\n\t\t\tfor(j = 0; j < scopes.length; j++) {\r\n\t\t\t\tif (!this.hasScope(tokens[i], scopes[j])) usethis = false\r\n\t\t\t}\r\n\r\n\t\t\tif (usethis) result.push(tokens[i])\r\n\t\t}\r\n\t\treturn result\r\n\t}\r\n\r\n\r\n\t/*\r\n\t * saveTokens() stores a list of tokens for a provider.\r\n\r\n\t\tUsually the tokens stored are a plain Access token plus:\r\n\t\t  * expires : time that the token expires\r\n\t\t  * providerID: the provider of the access token?\r\n\t\t  * scopes: an array with the scopes (not string)\r\n\t */\r\n\tsaveTokens(provider, tokens) {\r\n\t\t// log(\"Save Tokens (\" + provider+ \")\");\r\n\t\tlocalStorage.setItem(\"tokens-\" + provider, JSON.stringify(tokens))\r\n\t}\r\n\r\n\tgetTokens(provider) {\r\n\t\t// log(\"Get Tokens (\" + provider+ \")\");\r\n\t\tvar tokens = JSON.parse(localStorage.getItem(\"tokens-\" + provider))\r\n\t\tif (!tokens) tokens = []\r\n\r\n\t\tutils.log(\"Token found when loooking up provider \" + provider + \" in store \" + window.location.href, tokens)\r\n\t\treturn tokens\r\n\t}\r\n\r\n\twipeTokens(provider) {\r\n\t\tlocalStorage.removeItem(\"tokens-\" + provider)\r\n\t}\r\n\r\n\t/*\r\n\t * Save a single token for a provider.\r\n\t * This also cleans up expired tokens for the same provider.\r\n\t */\r\n\tsaveToken(provider, token) {\r\n\t\tvar tokens = this.getTokens(provider)\r\n\t\ttokens = this.filterTokens(tokens)\r\n\t\ttokens.push(token)\r\n\t\tthis.saveTokens(provider, tokens)\r\n\t}\r\n\r\n\t/*\r\n\t * Get a token if exists for a provider with a set of scopes.\r\n\t * The scopes parameter is OPTIONAL.\r\n\t */\r\n\tgetToken(provider, scopes) {\r\n\t\tvar tokens = this.getTokens(provider)\r\n\t\ttokens = this.filterTokens(tokens, scopes)\r\n\t\tif (tokens.length < 1) return null\r\n\t\treturn tokens[0]\r\n\t};\r\n\r\n}\r\n\r\nvar s = new Store()\r\n\r\nexport default s\r\n","/**\r\n * JSO - Javascript OAuth Library\r\n * \tVersion 4.1\r\n *  UNINETT AS - http://uninett.no\r\n *  Author: Andreas Åkre Solberg <andreas.solberg@uninett.no>\r\n *  Licence: Simplified BSD Licence\r\n */\r\n\r\n\r\nimport store from './store'\r\nimport utils from './utils'\r\n\r\n// Work in progress\r\n// import Authentication from './Authentication/Authentication'\r\n\r\nimport BasicLoader from './Loaders/BasicLoader'\r\n// import HTTPRedirect from './Loaders/HTTPRedirect'\r\nimport IFramePassive from './Loaders/IFramePassive'\r\nimport Popup from './Loaders/Popup'\r\n\r\nimport Fetcher from './HTTP/Fetcher'\r\n//import FetcherJQuery from './HTTP/FetcherJQuery'\r\n\r\n// import ExpiredTokenError from './errors/ExpiredTokenError'\r\n// import HTTPError from './errors/HTTPError'\r\nimport OAuthResponseError from './errors/OAuthResponseError'\r\n\r\nimport Config from './Config'\r\nimport EventEmitter from './EventEmitter'\r\n\r\nconst package_json = require('../package.json')\r\n\r\nconst default_config = {\r\n\t'lifetime': 3600\r\n}\r\n\r\nclass JSO extends EventEmitter {\r\n\tconstructor(config) {\r\n\t\tsuper();\r\n\t\tif(!config &&  Tangere) config = Tangere.identity;\r\n\t\tthis.configure(config);\r\n\t\tthis.providerID = this.getProviderID();\r\n\t\tthis.Loader = IFramePassive; // HTTPRedirect;\r\n\t\tthis.store = store;\r\n\t\tthis.callbacks = {};\r\n\r\n\t\tif (this.config.getValue('debug', false)) {\r\n\t\t\tutils.debug = true\r\n\t\t}\r\n\t}\r\n\r\n\tconfigure(config) {\r\n\t\tthis.config = new Config(default_config, config)\r\n\t}\r\n\r\n\t// Experimental, nothing but default store exists yet. Not documented.\r\n\tsetStore(newstore) {\r\n\t\tthis.store = newstore\r\n\t}\r\n\r\n\tsetLoader(loader) {\r\n\t\tif (typeof loader === \"function\") {\r\n\t\t\tthis.Loader = loader\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"loader MUST be an instance of the JSO BasicLoader\")\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * We need to get an identifier to represent this OAuth provider.\r\n\t * The JSO construction option providerID is preferred, if not provided\r\n\t * we construct a concatentaion of authorization url and client_id.\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tgetProviderID() {\r\n\r\n\t\tvar c = this.config.getValue('providerID', null)\r\n\t\tif (c !== null) { return c }\r\n\r\n\t\tvar client_id = this.config.getValue('client_id', null, true)\r\n\t\tvar authorization = this.config.getValue('authorization', null, true)\r\n\r\n\t\treturn authorization + '|' + client_id\r\n\t}\r\n\r\n\t/**\r\n\t * If the callback has already successfully parsed a token response, call this.\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tprocessTokenResponse(atoken) {\r\n\t\tlet state = null;\r\n\t\tif (this.config.useStore) {\r\n\t\t\tif (atoken.state) {\r\n\t\t\t\tstate = this.store.getState(atoken.state)\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Could not get state from storage.\")\r\n\t\t\t}\r\n\r\n\t\t\tif (!state) {\r\n\t\t\t\tthrow new Error(\"Could not retrieve state\")\r\n\t\t\t}\r\n\t\t\tif (!state.providerID) {\r\n\t\t\t\tthrow new Error(\"Could not get providerid from state\")\r\n\t\t\t}\r\n\t\t}\r\n\t\tutils.log(\"processTokenResponse \", atoken, \"\")\r\n\t\treturn this.processReceivedToken(atoken, state)\r\n\t}\r\n\r\n\tprocessReceivedToken(atoken, state) {\r\n\t\t/*\r\n\t\t\t * Decide when this token should expire.\r\n\t\t\t * Priority fallback:\r\n\t\t\t * 1. Access token expires_in\r\n\t\t\t * 2. Life time in config (may be false = permanent...)\r\n\t\t\t * 3. Specific permanent scope.\r\n\t\t\t * 4. Default library lifetime:\r\n\t\t\t */\r\n\t\tlet now = utils.epoch()\r\n\t\tatoken.received = now\r\n\t\tif (atoken.expires_in) {\r\n\t\t\tatoken.expires = now + parseInt(atoken.expires_in, 10)\r\n\t\t\tatoken.expires_in = parseInt(atoken.expires_in, 10)\r\n\t\t} else if (this.config.getValue('default_lifetime', null) === false) {\r\n\t\t\tatoken.expires = null\r\n\t\t} else if (this.config.has('permanent_scope')) {\r\n\t\t\tif (!this.store.hasScope(atoken, this.config.getValue('permanent_scope'))) {\r\n\t\t\t\tatoken.expires = null\r\n\t\t\t}\r\n\t\t} else if (this.config.has('default_lifetime')) {\r\n\t\t\tatoken.expires = now + this.config.getValue('default_lifetime')\r\n\t\t} else {\r\n\t\t\tatoken.expires = now + 3600\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t * Handle scopes for this token\r\n\t\t */\r\n\t\tif (atoken.scope) {\r\n\t\t\tatoken.scopes = atoken.scope.split(\" \")\r\n\t\t\tdelete atoken.scope\r\n\t\t} else if (state.scopes) {\r\n\t\t\tatoken.scopes = state.scopes\r\n\t\t} else {\r\n\t\t\tatoken.scopes = []\r\n\t\t}\r\n\r\n\t\tutils.log(\"processTokenResponse completed \", atoken, \"\")\r\n\r\n\t\tif (this.config.useStore) this.store.saveToken(state.providerID, atoken);\r\n\r\n\t\tif (state) {\r\n\t\t\tif (state.restoreHash) {\r\n\t\t\t\twindow.location.hash = state.restoreHash\r\n\t\t\t} else {\r\n\t\t\t\twindow.location.hash = ''\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn atoken\r\n\t}\r\n\r\n\t// Experimental support for authorization code to be added\r\n\tprocessAuthorizationCodeResponse(object) {\r\n\t\tconsole.log(this)\r\n\t\tthis.emit('authorizationCode', object)\r\n\r\n\t\tlet state\r\n\t\tif (object.state) {\r\n\t\t\tstate = this.store.getState(object.state)\r\n\t\t\tif (state === null) {\r\n\t\t\t\tthrow new Error(\"Could not find retrieve state object.\")\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Could not find state paramter from callback.\")\r\n\t\t}\r\n\t\tconsole.log(\"state\", state)\r\n\r\n\t\tif (!this.config.has('token')) {\r\n\t\t\tutils.log(\"Received an authorization code. Will not process it as the config option [token] endpoint is not set. If you would like to process the code yourself, please subscribe to the [authorizationCode] event\")\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.config.has('client_secret')) {\r\n\t\t\tthrow new Error(\"Configuration missing [client_secret]\")\r\n\t\t}\r\n\r\n\t\tlet headers = new Headers();\r\n\t\theaders.append('Authorization', 'Basic ' + btoa(this.config.getValue('client_id') + \":\" + this.config.getValue('client_secret')))\r\n\t\theaders.append('Content-Type', 'application/x-www-form-urlencoded;charset=UTF-8')\r\n\r\n\t\tlet tokenRequest = {\r\n\t\t\t'grant_type': 'authorization_code',\r\n\t\t\t'code': object.code\r\n\t\t}\r\n\r\n\t\tif (state.hasOwnProperty('redirect_uri')) {\r\n\t\t\ttokenRequest.redirect_uri = state.redirect_uri\r\n\t\t}\r\n\r\n\t\tlet opts = {\r\n\t\t\tmode: 'cors',\r\n\t\t\theaders: headers,\r\n\t\t\tmethod: 'POST', // or 'PUT'\r\n\t\t\tbody: utils.encodeQS(tokenRequest), // data can be `string` or {object}!\r\n\t\t}\r\n\t\treturn fetch(this.config.getValue('token'), opts)\r\n\t\t\t.then((httpResponse) => {\r\n\t\t\t\treturn httpResponse.json()\r\n\t\t\t})\r\n\t\t\t.then((tokenResponse) => {\r\n\t\t\t\t// let tokenResponse = httpResponse.json()\r\n\t\t\t\tutils.log(\"Received response on token endpoint \", tokenResponse, \"\")\r\n\t\t\t\treturn this.processReceivedToken(tokenResponse, state)\r\n\t\t\t})\r\n\r\n\t\t// throw new Exception(\"Implementation of authorization code flow is not yet implemented. Instead use the implicit grant flow\")\r\n\r\n\t}\r\n\r\n\r\n\r\n\tprocessErrorResponse(err) {\r\n\r\n\t\tvar state\r\n\t\tif (err.state) {\r\n\r\n\t\t\tstate = this.store.getState(err.state)\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Could not get [state] and no default providerid is provided.\")\r\n\t\t}\r\n\r\n\t\tif (!state) {\r\n\t\t\tthrow new Error(\"Could not retrieve state\")\r\n\t\t}\r\n\t\tif (!state.providerID) {\r\n\t\t\tthrow new Error(\"Could not get providerid from state\")\r\n\t\t}\r\n\r\n\t\tif (state.restoreHash) {\r\n\t\t\twindow.location.hash = state.restoreHash\r\n\t\t} else {\r\n\t\t\twindow.location.hash = ''\r\n\t\t}\r\n\t\treturn new OAuthResponseError(err)\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Check if the hash contains an access token.\r\n\t * And if it do, extract the state, compare with\r\n\t * config, and store the access token for later use.\r\n\t *\r\n\t * The url parameter is optional. Used with phonegap and\r\n\t * childbrowser when the jso context is not receiving the response,\r\n\t * instead the response is received on a child browser.\r\n\t */\r\n\tcallback(data) {\r\n\t\tdebugger;\r\n\t\tlet response = null;\r\n\t\tif (typeof data === 'object') {\r\n\t\t\tresponse = data;\r\n\t\t} else if (typeof data === 'string') {\r\n\t\t\tresponse = utils.getResponseFromURL(data);\r\n\t\t} else if (typeof data === 'undefined') {\r\n\t\t\tresponse = utils.getResponseFromURL(window.location.href);\r\n\t\t} else {\r\n\t\t\t// no response provided.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tutils.log('Receving response in callback', response)\r\n\r\n\t\tif (response.hasOwnProperty(\"access_token\")) {\r\n\t\t\treturn this.processTokenResponse(response)\r\n\r\n\t\t\t// Implementation of authorization code flow is in beta.\r\n\t\t} else if (response.hasOwnProperty(\"code\")) {\r\n\t\t\treturn this.processAuthorizationCodeResponse(response)\r\n\r\n\t\t} else if (response.hasOwnProperty(\"error\")) {\r\n\t\t\tthrow this.processErrorResponse(response)\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tdump() {\r\n\t\tvar tokens = this.store.getTokens(this.providerID)\r\n\t\tvar x = {\r\n\t\t\t\"providerID\": this.providerID,\r\n\t\t\t\"tokens\": tokens,\r\n\t\t\t\"config\": this.config\r\n\t\t}\r\n\t\treturn x\r\n\t}\r\n\r\n\t_getRequestScopes(opts) {\r\n\t\tvar scopes = [], i\r\n\t\t/*\r\n\t\t * Calculate which scopes to request, based upon provider config and request config.\r\n\t\t */\r\n\t\tif (this.config.has('scopes.request')) {\r\n\t\t\tlet s = this.config.getValue('scopes.request')\r\n\t\t\tfor (i = 0; i < s.length; i++) {\r\n\t\t\t\tscopes.push(s[i])\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (opts && opts.scopes && opts.scopes.request) {\r\n\t\t\tfor (i = 0; i < opts.scopes.request.length; i++) { scopes.push(opts.scopes.request[i]) }\r\n\t\t}\r\n\t\treturn utils.uniqueList(scopes)\r\n\t}\r\n\r\n\t_getRequiredScopes(opts) {\r\n\t\tvar scopes = [], i\r\n\t\t/*\r\n\t\t * Calculate which scopes to request, based upon provider config and request config.\r\n\t\t */\r\n\t\tif (this.config.has('scopes.require')) {\r\n\t\t\tlet s = this.config.getValue('scopes.require')\r\n\t\t\tfor (i = 0; i < s.length; i++) {\r\n\t\t\t\tscopes.push(s[i])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (opts && opts.scopes && opts.scopes.require) {\r\n\t\t\tfor (i = 0; i < opts.scopes.require.length; i++) { scopes.push(opts.scopes.require[i]) }\r\n\t\t}\r\n\t\treturn utils.uniqueList(scopes)\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * If getToken is called with allowia = false, and a token is not cached, it will return null.\r\n\t * The scopes.required is used to pick from existing tokens.\r\n\t *\r\n\t * @param  {[type]} opts [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tgetToken(opts) {\r\n\r\n\t\topts = opts || {\r\n\t\t\t// default: silent OpenId Request\r\n            scopes: {\r\n                request: ['openid', 'profile']\r\n            },\r\n            response_type: 'id_token token',\r\n            request: {\r\n                prompt: 'none'\r\n            }\r\n        };\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\r\n\t\t\tlet scopesRequire = this._getRequiredScopes(opts)\r\n\t\t\tlet token = null;\r\n\r\n\t\t\tif (this.config.useStore) token = this.store.getToken(this.providerID, scopesRequire)\r\n\r\n\t\t\tif (token) {\r\n\t\t\t\treturn resolve(token)\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif (opts.hasOwnProperty(\"allowredir\") && !opts.allowredir) {\r\n\t\t\t\t\tthrow new Error(\"Cannot obtain a token, when not allowed to redirect...\")\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(this._authorize(opts))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t}\r\n\r\n\tcheckToken(opts) {\r\n\t\t// var scopesRequest  = this._getRequestScopes(opts)\r\n\r\n\t\tvar scopesRequire = this._getRequiredScopes(opts);\r\n\t\tif (!this.config.useStore) return null;\r\n\t\treturn this.store.getToken(this.providerID, scopesRequire)\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Send authorization request.\r\n\t *\r\n\t * @param  {[type]} opts These options matches the ones sent in the \"oauth\" property of the ajax settings in the request.\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\t_authorize(opts) {\r\n\r\n\t\tvar request, authurl, scopes;\r\n\r\n\t\treturn Promise.resolve().then(() => {\r\n\r\n\t\t\tlet openid = false;\r\n\t\t\tlet authorization = this.config.getValue('authorization', null, true);\r\n\t\t\tlet client_id = this.config.getValue('client_id', null, true);\r\n\t\t\tlet login_hint = this.config.getValue('login_hint', '', false);\r\n\t\t\tlet redirect_uri = this.config.getValue('redirect_uri', '', false);\r\n\r\n\t\t\tutils.log(\"About to send an authorization request to this endpoint\", authorization)\r\n\t\t\tutils.log(\"Options\", opts)\r\n\r\n\t\t\trequest = {};\r\n\r\n\t\t\tif (this.config.has('request')) {\r\n\t\t\t\tlet r = this.config.getValue('request');\r\n\t\t\t\trequest = Object.assign(request, r);\r\n\t\t\t}\r\n\r\n\t\t\tif (opts.hasOwnProperty('request')) {\r\n\t\t\t\trequest = Object.assign(request, opts.request);\r\n\t\t\t}\r\n\r\n\t\t\trequest.response_type = opts.response_type || this.config.getValue('response_type', 'id_token token');\r\n\t\t\trequest.state = utils.uuid();\r\n\r\n\t\t\tif (this.config.has('redirect_uri')) {\r\n\t\t\t\trequest.redirect_uri = this.config.getValue('redirect_uri', '');\r\n\t\t\t}\r\n\r\n\t\t\tif (login_hint) request.login_hint = login_hint;\r\n\t\t\tif (opts.redirect_uri) request.redirect_uri = opts.redirect_uri;\r\n\r\n\t\t\trequest.client_id = client_id;\r\n\r\n\t\t\t/*\r\n\t\t\t * Calculate which scopes to request, based upon provider config and request config.\r\n\t\t\t */\r\n\t\t\tscopes = this._getRequestScopes(opts);\r\n\t\t\topenid = scopes.includes('openid');\r\n\r\n\t\t\tif (scopes.length > 0) {\r\n\t\t\t\trequest.scope = utils.scopeList(scopes)\r\n\t\t\t}\r\n\r\n\t\t\tutils.log(\"Running in mode: \" + (openid ? 'OpenID Connect mode' : 'OAuth mode'))\r\n\r\n\t\t\tif (openid && !request.hasOwnProperty('redirect_uri')) {\r\n\t\t\t\tthrow new Error('An OpenID Request requires a redirect_uri to be set. Please add to configuration. A redirect_uri is not required for plain OAuth')\r\n\t\t\t}\r\n\r\n\t\t\tif (openid) {\r\n\t\t\t\trequest.nonce = utils.uuid();\r\n\t\t\t}\r\n\r\n\t\t\tutils.log(\"Debug Authentication request object\", JSON.stringify(request, undefined, 2));\r\n\r\n\t\t\tauthurl = utils.encodeURL(authorization, request);\r\n\t\t\tutils.log(\"authurl\", authurl);\r\n\r\n\t\t\t// We'd like to cache the hash for not loosing Application state.\r\n\t\t\t// With the implciit grant flow, the hash will be replaced with the access\r\n\t\t\t// token when we return after authorization.\r\n\t\t\tif (window.location.hash) {\r\n\t\t\t\trequest.restoreHash = window.location.hash\r\n\t\t\t}\r\n\r\n\t\t\trequest.providerID = this.providerID\r\n\t\t\tif (scopes) {\r\n\t\t\t\trequest.scopes = scopes\r\n\t\t\t}\r\n\r\n\t\t\tvar loader = this.Loader\r\n\t\t\tif (opts.hasOwnProperty(\"loader\")) {\r\n\t\t\t\tloader = opts.loader\r\n\t\t\t}\r\n\r\n\t\t\tutils.log(\"Looking for loader\", opts, loader)\r\n\r\n\t\t\tif (this.config.useStore) this.store.saveState(request.state, request);\r\n\r\n\t\t\treturn this.gotoAuthorizeURL(authurl, loader, redirect_uri)\r\n\t\t\t\t.then((response) => {\r\n\t\t\t\t\tif (response !== true) {\r\n\t\t\t\t\t\treturn this.callback(response)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tgotoAuthorizeURL(url, Loader, redirect_uri) {\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\tif (Loader !== null && typeof Loader === 'function') {\r\n\t\t\t\tvar loader = new Loader(url, redirect_uri);\r\n\r\n\t\t\t\tif (!(loader instanceof BasicLoader)) {\r\n\t\t\t\t\tthrow new Error(\"JSO selected Loader is not an instance of BasicLoader.\")\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresolve(loader.execute());\r\n\r\n\t\t\t} else {\r\n\t\t\t\treject(new Error('Cannot redirect to authorization endpoint because of missing redirect handler'));\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\twipeTokens() {\r\n\t\tthis.store.wipeTokens(this.providerID)\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { JSO, BasicLoader, Popup, IFramePassive, Fetcher }\r\n"],"sourceRoot":""}